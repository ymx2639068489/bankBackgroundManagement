(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b470b08e"],{"5d2f":function(t,e,a){"use strict";a("a3e9")},"7f46":function(t,e,a){"use strict";a("fdac")},"8c79":function(t,e,a){"use strict";a("fa92")},"919b":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("product-list-cpm",{attrs:{list:t.showList,"user-roles":t.allUserRolesList},on:{updateUserRoles:t.updateUserRoles,addAdmin:function(e){t.$refs.addAdmin.dialogVisible=!0},showMore:t.showMore}}),a("page",{attrs:{"total-pages":10*t.totalPages,"index-page":t.indexPage},on:{pageChange:t.pageChange}}),a("add-admin",{ref:"addAdmin",on:{addAdmin:t.addAdmin}}),a("roles-list",{ref:"rolesList",attrs:{"user-info":t.currentUserInfo,"user-roles":t.allRolesList},on:{doAssignRole:t.doAssignRole}}),a("show-more-user-info",{ref:"showMoreUserInfo",attrs:{"user-info":t.currentUserInfo},on:{updateCurrenAdminInfo:t.updateCurrenAdminInfo}})],1)},i=[],n=a("2909"),o=a("b85c"),r=(a("a4d3"),a("e01a"),a("a434"),a("99af"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-pagination",{ref:"page",attrs:{background:"","hide-on-single-page":!0,layout:"prev, pager, next",total:t.totalPages,"current-page":t.$parent.indexPage},on:{"update:currentPage":function(e){return t.$set(t.$parent,"indexPage",e)},"update:current-page":function(e){return t.$set(t.$parent,"indexPage",e)},"current-change":t.handleCurrentChange}})}),l=[],d=(a("a9e3"),{props:{totalPages:{type:Number,default:0}},methods:{handleCurrentChange:function(t){this.$emit("pageChange",t)}}}),u=d,c=(a("7f46"),a("2877")),f=Object(c["a"])(u,r,l,!1,null,"616201ce",null),h=f.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"新建管理员",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{attrs:{model:t.form}},[a("el-form-item",{attrs:{label:"账号:","label-width":t.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"是否随机密码:","label-width":t.formLabelWidth}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.form.is_random_password,callback:function(e){t.$set(t.form,"is_random_password",e)},expression:"form.is_random_password"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!t.form.is_random_password,expression:"!form.is_random_password"}],attrs:{label:"密码:","label-width":t.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),a("el-form-item",{attrs:{label:"邮箱:","label-width":t.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),a("el-form-item",{attrs:{label:"手机号:","label-width":t.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),a("el-form-item",{attrs:{label:"状态:","label-width":t.formLabelWidth}},[a("el-radio",{attrs:{label:0},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v("激活")]),a("el-radio",{attrs:{label:1},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[t._v("封禁")])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)},p=[],g={data:function(){return{dialogVisible:!1,form:{username:"",password:"",phone:"",email:"",status:0,is_random_password:!1},formLabelWidth:"125px"}},methods:{submit:function(){var t=this.form,e=t.username,a=t.phone,s=t.email;e?s?a&&11===a.length?(this.form.password=this.$md5(this.form.password),this.$emit("addAdmin",this.form),this.dialogVisible=!1):this.$message({message:"请输入正确的手机号",type:"warning"}):this.$message({message:"请输入邮箱",type:"warning"}):this.$message({message:"请输入账号",type:"warning"})}}},b=g,_=Object(c["a"])(b,m,p,!1,null,"8cb376b8",null),v=_.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.dialogVisible?a("el-dialog",{attrs:{title:"权限列表",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-tree",{ref:"tree",attrs:{data:t.userRoles,"show-checkbox":"","node-key":"value","default-checked-keys":t.userInfo.roles,"highlight-current":"",props:t.defaultProps,"render-content":t.renderContent,"check-on-click-node":!0}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.sureDoAssignRole}},[t._v("确 定")])],1)],1):t._e()},I=[],y={props:{userInfo:{type:Object,default:function(){return{}}},userRoles:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,defaultProps:{label:"title"}}},watch:{dialogVisible:function(t,e){e&&this.$refs.tree.setCheckedKeys([])}},methods:{renderContent:function(t,e){e.node;var a=e.data;return t("span",[a.value," + ",a.label])},sureDoAssignRole:function(){var t,e=this.$refs.tree.getCheckedNodes(),a=[],s=Object(o["a"])(e);try{for(s.s();!(t=s.n()).done;){var i=t.value;a.push(i.ID)}}catch(n){s.e(n)}finally{s.f()}0!==a.length?(this.dialogVisible=!1,this.$emit("doAssignRole",a,this.userInfo.uuid)):this.$message.error("请选择权限")}}},k=y,$=Object(c["a"])(k,w,I,!1,null,"281236fe",null),x=$.exports,U=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{attrs:{data:t.list}},[a("el-table-column",{attrs:{prop:"ID",label:"ID",width:"50"}}),a("el-table-column",{attrs:{label:"昵称",prop:"nick_name",width:"80",fixed:""}}),a("el-table-column",{attrs:{label:"账号",prop:"username",width:"100"}}),a("el-table-column",{attrs:{label:"手机号",prop:"phone",width:"110"}}),a("el-table-column",{attrs:{label:"权限",width:"400"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.roles,(function(e){return a("div",{key:e,staticClass:"tag-item"},[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[a("p",[t._v(t._s(t.userRoles&&t.userRoles[e]?t.userRoles[e]:e))]),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",[t._v(t._s(e))])],1)])],1)}))}}])}),a("el-table-column",{attrs:{align:"right","min-width":"250"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("div",[a("el-button",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{type:"primary"},on:{click:t.addAdmin}},[t._v(" 添加管理员 ")]),a("el-input",{staticStyle:{width:"200px"},attrs:{"prefix-icon":"el-icon-search",placeholder:"输入关键字搜索"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},[a("el-button",{attrs:{slot:"append",type:"primary",icon:"el-icon-search"},on:{click:t.goSearch},slot:"append"})],1)],1),t._e()]}},{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.handleEdit(e.$index,e.row)}}},[t._v("分配权限")]),a("el-button",{attrs:{size:"small"},on:{click:function(a){return t.handleShow(e.$index,e.row)}}},[t._v("查看/修改更多")])]}}])})],1)},A=[],L=(a("ac1f"),a("841c"),{props:{list:{type:Array,default:function(){return[]}},userRoles:{type:Object,default:function(){return{}}}},data:function(){return{search:""}},methods:{goSearch:function(){console.log("搜索",this.search)},handleShow:function(t,e){this.$emit("showMore",e)},handleEdit:function(t,e){this.$emit("updateUserRoles",e)},addAdmin:function(){this.$emit("addAdmin")}}}),W=L,C=(a("8c79"),Object(c["a"])(W,U,A,!1,null,"258ca820",null)),P=C.exports,O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.dialogVisible?a("el-dialog",{staticStyle:{width:"1300px"},attrs:{title:"管理员信息",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("table",{staticClass:"table-box",staticStyle:{"margin-left":"50px"},attrs:{border:"0"}},[a("tr",{attrs:{height:t.lineHeight}},[a("td",{attrs:{width:t.lableWidth}},[t._v("昵称: ")]),a("td",{attrs:{width:t.dataWidth}},[a("el-input",{staticClass:"inputs",attrs:{placeholder:"请输入昵称"},model:{value:t.updateUserInfo.nick_name,callback:function(e){t.$set(t.updateUserInfo,"nick_name",e)},expression:"updateUserInfo.nick_name"}})],1)]),a("tr",{attrs:{height:t.lineHeight}},[a("td",{attrs:{width:t.lableWidth}},[t._v("邮 箱：")]),a("td",{attrs:{width:t.dataWidth}},[a("el-input",{staticClass:"inputs",attrs:{placeholder:"请输入邮箱"},model:{value:t.updateUserInfo.email,callback:function(e){t.$set(t.updateUserInfo,"email",e)},expression:"updateUserInfo.email"}})],1),a("td",{attrs:{width:t.lableWidth}},[t._v("用户名: ")]),a("td",{attrs:{width:t.dataWidth}},[t._v(t._s(t.userInfo.username))])]),a("tr",{attrs:{height:t.lineHeight}},[a("td",{attrs:{width:t.lableWidth}},[t._v("手机号: ")]),a("td",{attrs:{width:t.dataWidth}},[a("el-input",{staticClass:"inputs",attrs:{placeholder:"请输入手机号"},model:{value:t.updateUserInfo.phone,callback:function(e){t.$set(t.updateUserInfo,"phone",e)},expression:"updateUserInfo.phone"}})],1),a("td",{attrs:{width:t.lableWidth}},[t._v("状态：")]),a("td",{attrs:{width:t.dataWidth}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.updateUserInfo.status,callback:function(e){t.$set(t.updateUserInfo,"status",e)},expression:"updateUserInfo.status"}})],1)]),a("tr",{attrs:{height:t.lineHeight}},[a("td",{attrs:{width:t.lableWidth}},[t._v("创建人: ")]),a("td",{attrs:{width:t.dataWidth}},[t._v(t._s(t.userInfo.create_by_username))]),a("td",{attrs:{width:t.lableWidth}},[t._v("创建时间：")]),a("td",{attrs:{width:t.dataWidth}},[t._v(t._s(t.$IsoToString(t.userInfo.created_at)))])]),a("tr",{attrs:{height:t.lineHeight}},[a("td",{attrs:{width:t.lableWidth}},[t._v("登录IP: ")]),a("td",{attrs:{width:t.dataWidth}},[t._v(t._s(t.userInfo.login_ip))]),a("td",{attrs:{width:t.lableWidth}},[t._v("登录时间：")]),a("td",{attrs:{width:t.dataWidth}},[t._v(t._s(t.$IsoToString(t.userInfo.login_time)))])])]),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.userUpdate}},[t._v("确 定")])],1)]):t._e()},R=[],V={props:{userInfo:{type:Object,default:function(){return{ID:"",username:"",phone:"",email:"",status:0,create_by_username:"",created_at:"",login_ip:"",login_time:"",nick_name:"",roles:[],uuid:""}}}},data:function(){return{dialogVisible:!1,lableWidth:"100px",dataWidth:"150px",lineHeight:"40px",updateUserInfo:{UUID:this.userInfo.uuid,email:this.userInfo.email,nick_name:this.userInfo.nick_name,phone:this.userInfo.phone,status:0===this.userInfo.status}}},watch:{dialogVisible:function(t){t&&(this.updateUserInfo={UUID:this.userInfo.uuid,email:this.userInfo.email,nick_name:this.userInfo.nick_name,phone:this.userInfo.phone,status:0===this.userInfo.status})}},methods:{userUpdate:function(){var t=this;this.$confirm("此操作将更改管理员信息，确定继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("updateCurrenAdminInfo",t.updateUserInfo),t.dialogVisible=!1}))}}},j=V,D=(a("5d2f"),Object(c["a"])(j,O,R,!1,null,"31887ee9",null)),S=D.exports,E=(a("d3b7"),a("159b"),a("b775")),N=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return new Promise((function(a,s){Object(E["a"])({url:"/api/admin/getAdminInfoList",method:"post",data:JSON.stringify({page:t,page_size:e})}).then((function(t){var e=[];t.data.data.forEach((function(t){var a,s=[],i=Object(o["a"])(t.authorities);try{for(i.s();!(a=i.n()).done;){var n=a.value;s.push(n.authority_name)}}catch(r){i.e(r)}finally{i.f()}e.push({ID:t.ID,create_by_username:t.create_by_username,created_at:t.created_at,email:t.email,login_ip:t.login_ip,login_time:t.login_time,nick_name:t.nick_name,phone:t.phone,username:t.username,roles:s,uuid:t.uuid,status:t.status})})),a({data:e,total:t.data.total})}))}))},M=function(t){console.log(t);var e=t.email,a=t.is_random_password,s=t.password,i=t.phone,n=t.username,o=t.status;return o=Number(o),new Promise((function(t,r){Object(E["a"])({url:"/api/admin/generateAdminAccount",method:"post",data:JSON.stringify({email:e,is_random_password:a,password:s,phone:i,username:n,status:o})}).then((function(e){console.log(e),0!==e.code&&r(e.msg),t(e.msg)}))}))},z=function(){return new Promise((function(t,e){Object(E["a"])({url:"/api/admin/authority/all",method:"post",data:JSON.stringify({page:1,page_size:100})}).then((function(a){0!==a.code&&e(a.msg),t(a.data)}))}))},J=function(t,e){return new Promise((function(a,s){Object(E["a"])({url:"/api/admin/setAdminAuthorities",method:"put",data:JSON.stringify({authority_id:t,uuid:e})}).then((function(t){0!==t.code&&s(t.msg),a(t.data)}))}))},T=function(t){var e=t.UUID,a=t.email,s=t.nick_name,i=t.phone,n=t.status;return n=n?0:1,new Promise((function(t,o){e?Object(E["a"])({url:"/api/admin/setAdminInfo",method:"put",data:JSON.stringify({UUID:e,email:a,nick_name:s,phone:i,status:n})}).then((function(e){0!==e.code&&o(e.msg),t(e.msg)})):o("UUID不能为空")}))},H={components:{page:h,addAdmin:v,rolesList:x,productListCpm:P,showMoreUserInfo:S},data:function(){return{indexPage:1,totalPages:20,page_size:10,showList:[],currentUserInfo:{roles:[]},allUserRolesList:{},allRolesList:[]}},created:function(){var t=this;z().then((function(e){var a,s=Object(o["a"])(e.List);try{for(s.s();!(a=s.n()).done;){var i=a.value;t.allUserRolesList[i.authority_name]=i.description,t.allRolesList.push({value:i.authority_name,label:i.description,ID:i.ID})}}catch(n){s.e(n)}finally{s.f()}})),this.indexPage=this.$store.getters.getAdminPage,this.getAdminList(this.indexPage)},beforeDestroy:function(){this.$store.commit("cacheData/SET_ADMIN_PAGE",this.indexPage)},methods:{pageChange:function(t){this.page=t,this.getAdminList()},updateUserRoles:function(t){this.currentUserInfo=t,this.$refs.rolesList.dialogVisible=!0},showMore:function(t){this.currentUserInfo=t,this.$refs.showMoreUserInfo.dialogVisible=!0},addAdmin:function(t){var e=this;M(t).then((function(t){e.$message({message:"添加成功",type:"success"}),e.getAdminList()}))},updateCurrenAdminInfo:function(t){var e=this;T(t).then((function(t){e.$message({message:"修改成功",type:"success"}),setTimeout((function(){e.getAdminList()}),500)}))},getAdminList:function(){var t=this;N(this.indexPage,this.page_size).then((function(e){var a;t.totalPages=Math.ceil(e.total/t.page_size);var s=e.data;(a=t.showList).splice.apply(a,[0,t.showList.length].concat(Object(n["a"])(s)))}))},doAssignRole:function(t,e){var a=this;J(t,e).then((function(t){a.$message({message:"分配成功",type:"success"}),setTimeout((function(){a.getAdminList()}),500)}))}}},B=H,G=Object(c["a"])(B,s,i,!1,null,"14ed995a",null);e["default"]=G.exports},a3e9:function(t,e,a){},fa92:function(t,e,a){},fdac:function(t,e,a){}}]);