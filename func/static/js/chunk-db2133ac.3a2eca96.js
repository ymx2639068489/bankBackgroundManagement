(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-db2133ac"],{"0bdd":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",[i("el-header",[i("b",[t._v(t._s(t.$store.getters.getCurrentActive.activity_name))]),t._v(" 筛选配置 ")]),i("el-container",[i("el-aside",{attrs:{width:"400px"}},[i("left",{attrs:{"filter-list":t.filterList}})],1),i("el-main",[i("h3",{staticClass:"yiy"},[t._v("选择新规则")]),i("right",{attrs:{"current-filter-list":t.filterList},on:{addItem:t.addItem}})],1)],1)],1)},n=[],a=i("b85c"),l=(i("a434"),i("d3b7"),i("a4d3"),i("e01a"),i("b775"));function s(){return new Promise((function(t,e){l["a"].get("/api/filter/tableList").then((function(e){t(e.data)}))}))}function o(t){return new Promise((function(e,i){l["a"].post("/api/filter/fieldList",{table_name:t}).then((function(t){e(t.data)}))}))}function c(){return new Promise((function(t,e){l["a"].get("/api/filter/list").then((function(e){t(e.data)}))}))}function f(t){return new Promise((function(e,i){l["a"].post("/api/filter/getFilterRolesByID",{activity_id:t}).then((function(t){e(t.data)}))}))}function u(t){return console.log(t),new Promise((function(e,i){Object(l["a"])({url:"/api/filter/finishFilterConfiguration",method:"post",data:JSON.stringify({activity_id:t})}).then((function(t){e(t.msg)}))}))}function d(t){var e=t.activity_id,i=t.description,r=t.error_tips,n=t.field_name,a=t.filter_table_id,s=t.value_range;return new Promise((function(t,o){l["a"].post("/api/filter/setValueRange",{activity_id:e,description:i,error_tips:r,field_name:n,filter_table_id:a,value_range:s}).then((function(e){t(e.msg)}))}))}function _(t){return new Promise((function(e,i){Object(l["a"])({url:"/api/filter/deleteByID",method:"delete",data:JSON.stringify({filter_roles_id:t})}).then((function(t){e(t.msg)}))}))}var m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-button",{staticClass:"left_top_btn",attrs:{disabled:t.filterList.length<=0},on:{click:t.finishFilterConfig}},[t._v("完成配置")]),i("h3",{staticClass:"yiy"},[t._v("活动已有规则")]),i("ul",{staticClass:"infinite-list",staticStyle:{overflow:"auto"}},t._l(t.filterList,(function(e,r){return i("li",{key:r,staticClass:"infinite-list-item"},[i("el-card",{staticStyle:{"margin-top":"15px"},attrs:{shadow:"always"}},[t._v(" "+t._s(r+1)+". "+t._s(e.description)+" "),i("el-button",{staticStyle:{"margin-left":"50px"},attrs:{icon:"el-icon-delete",circle:""},on:{click:function(e){return t.delItem(r)}}})],1)],1)})),0)],1)},h=[],v={props:{filterList:{type:Array,default:function(){return[]}}},methods:{delItem:function(t){var e=this;this.$confirm("确定删除该规则吗？").then((function(){_(e.filterList[t].ID).then((function(i){e.$message({type:"success",message:i}),e.filterList.splice(t,1)}))})).catch((function(){}))},finishFilterConfig:function(){var t=this;u(this.$store.getters.getCurrentActive.activity_id).then((function(e){t.$message({type:"success",message:"配置完成"}),t.$store.commit("cacheData/SET_CURRENT_ACTIVE",{}),setTimeout((function(){t.$router.push("/activity/activityList")}),2e3)}))}}},g=v,b=(i("3da1"),i("2877")),p=Object(b["a"])(g,m,h,!1,null,"3fab83ca",null),y=p.exports,L=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",{staticStyle:{height:"500px",border:"1px solid #eee"}},[i("el-aside",{staticStyle:{"background-color":"rgb(238, 241, 246)"},attrs:{width:"200px"}},[i("el-menu",{attrs:{"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b","default-active":"-1"}},[i("el-menu-item",{attrs:{index:"-1"},nativeOn:{click:function(e){t.is_click_current=!1}}},[t._v(t._s("从已有规则中选")+" ")]),t._l(t.tableList,(function(e,r){return i("el-menu-item",{key:r,attrs:{index:String(r)},nativeOn:{click:function(i){return t.handleClick(e)}}},[t._v(t._s(e.table_name)+" ")])}))],2)],1),i("el-container",[i("el-main",[i("el-table",{directives:[{name:"show",rawName:"v-show",value:t.is_click_current,expression:"is_click_current"}],attrs:{data:t.current.table_field}},[i("el-table-column",{attrs:{label:"字段",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row)+" ")]}}])}),i("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.handleEdit(e.row)}}},[t._v("select")])]}}])})],1),i("el-table",{directives:[{name:"show",rawName:"v-show",value:!t.is_click_current,expression:"!is_click_current"}],attrs:{data:t.filterList}},[i("el-table-column",{attrs:{label:"描述",prop:"description",width:"140"}}),i("el-table-column",{attrs:{label:"表",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.tableList.find((function(t){return t.id===e.row.filter_table_id}))?t.tableList.find((function(t){return t.id===e.row.filter_table_id})).table_name:"")+" ")]}}])}),i("el-table-column",{attrs:{label:"字段",prop:"filed_name",width:"140"}}),i("el-table-column",{attrs:{label:"范围",prop:"value_range",width:"140"}}),i("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.handleSelect(e.row)}}},[t._v("select")])]}}])})],1)],1)],1),i("el-dialog",{attrs:{title:"新增规则"+t.current.field_name,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{attrs:{model:t.form}},[i("el-form-item",{attrs:{label:"描述信息","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),i("el-form-item",{attrs:{label:"拒绝后信息","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.error_tips,callback:function(e){t.$set(t.form,"error_tips",e)},expression:"form.error_tips"}})],1),i("el-form-item",{attrs:{label:"选值范围","label-width":t.formLabelWidth}},[i("el-input",{staticStyle:{width:"40%","margin-right":"8%"},attrs:{autocomplete:"off"},model:{value:t.form.value_range_left,callback:function(e){t.$set(t.form,"value_range_left",e)},expression:"form.value_range_left"}}),t._v(" - "),i("el-input",{staticStyle:{width:"40%","margin-left":"8%"},attrs:{autocomplete:"off"},model:{value:t.form.value_range_right,callback:function(e){t.$set(t.form,"value_range_right",e)},expression:"form.value_range_right"}})],1),i("p",[t._v("若当前字段为文字则只用填写任意一个空即可，若为数值则填写一个区间范围")])],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)],1)},w=[],$=(i("9129"),i("a9e3"),{props:{currentFilterList:{type:Array,default:function(){return[]}}},data:function(){return{tableList:[],current:{field_name:"",table_field:[]},filterList:[],is_click_current:!1,dialogFormVisible:!1,form:{description:"",value_range_left:"",value_range_right:"",error_tips:""},formLabelWidth:"100px"}},watch:{dialogFormVisible:function(t,e){e&&(this.form.description="",this.form.value_range_left="",this.form.value_range_right="")}},created:function(){this.getFilterList(),this.getTbaleName()},methods:{getFilterList:function(){var t=this;c().then((function(e){var i,r=Object(a["a"])(e.List);try{for(r.s();!(i=r.n()).done;){var n,l=i.value,s=!0,o=Object(a["a"])(t.filterList);try{for(o.s();!(n=o.n()).done;){var c=n.value;l.field_name===c.field_name&&l.value_range===c.value_range&&(s=!1)}}catch(f){o.e(f)}finally{o.f()}s&&t.filterList.push(l)}}catch(f){r.e(f)}finally{r.f()}}))},getTbaleName:function(){var t=this;s().then((function(e){for(var i=function(i){t.tableList.push({id:e[i].id,table_name:e[i].table_name,table_field:[]}),o(e[i].table_name).then((function(e){for(var r in e)t.tableList[i].table_field.push(e[r])}))},r=0;r<e.length;r++)i(r)}))},handleClick:function(t){this.is_click_current=!0,this.current=t},handleEdit:function(t){this.dialogFormVisible=!0,this.current.field_name=t},handleSelect:function(t){var e,i=this,r=this,n=Object(a["a"])(this.currentFilterList);try{for(n.s();!(e=n.n()).done;){var l=e.value;if(l.filter_table_id===t.filter_table_id&&l.field_name===t.field_name&&l.value_range===t.value_range)return void this.$message({type:"warning",message:"已存在"})}}catch(s){n.e(s)}finally{n.f()}d({activity_id:this.$store.getters.getCurrentActive.activity_id,description:t.description,field_name:t.filed_name,filter_table_id:t.filter_table_id,value_range:t.value_range}).then((function(t){i.$message({type:"success",message:t}),r.$emit("addItem"),r.dialogFormVisible=!1}))},submit:function(){var t=this,e=this.form,i=e.description,r=e.value_range_left,n=e.value_range_right,a=e.error_tips;if(""===i||""===r&&""===n||""===a)this.$message({type:"warning",message:"请填写完整信息"});else if(Number.isNaN(Number(r))||Number.isNaN(Number(n))){var l=r||n;l="'"+l+"'";var s={activity_id:this.$store.getters.getCurrentActive.activity_id,description:this.form.description,field_name:this.current.field_name,filter_table_id:this.current.id,error_tips:a,value_range:"="+l};d(s).then((function(e){t.$message({type:"success",message:e}),t.$emit("addItem"),t.getFilterList(),t.dialogFormVisible=!1}))}else if(r!==n)if(r)if(n){var o={activity_id:this.$store.getters.getCurrentActive.activity_id,description:this.form.description,field_name:this.current.field_name,filter_table_id:this.current.id,error_tips:a,value_range:">="+r};d(o).then((function(){o.value_range="<="+n,d(o).then((function(e){t.$message({type:"success",message:e}),t.$emit("addItem"),t.getFilterList(),t.dialogFormVisible=!1}))}))}else{var c={activity_id:this.$store.getters.getCurrentActive.activity_id,description:this.form.description,field_name:this.current.field_name,filter_table_id:this.current.id,error_tips:a,value_range:">="+r};d(c).then((function(e){t.$message({type:"success",message:e}),t.$emit("addItem"),t.getFilterList(),t.dialogFormVisible=!1}))}else{var f={activity_id:this.$store.getters.getCurrentActive.activity_id,description:this.form.description,field_name:this.current.field_name,filter_table_id:this.current.id,error_tips:a,value_range:"<="+n};d(f).then((function(e){t.$message({type:"success",message:e}),t.$emit("addItem"),t.getFilterList(),t.dialogFormVisible=!1}))}else{var u={activity_id:this.$store.getters.getCurrentActive.activity_id,description:this.form.description,field_name:this.current.field_name,filter_table_id:this.current.id,error_tips:a,value_range:"="+r};d(u).then((function(e){t.$message({type:"success",message:e}),t.$emit("addItem"),t.getFilterList(),t.dialogFormVisible=!1}))}}}}),k=$,F=(i("dbd9"),Object(b["a"])(k,L,w,!1,null,"b0528ed2",null)),C=F.exports,x={components:{left:y,right:C},data:function(){return{activity_id:"",count:13,filterList:[]}},created:function(){var t=this;this.activity_id=this.$store.getters.getCurrentActive.activity_id,this.activity_id||(this.$message.error("请先选择活动"),setTimeout((function(){t.$router.push("/activity")}),1e3)),this.getFilterListByActivityID()},methods:{getFilterListByActivityID:function(){var t=this;f(this.activity_id).then((function(e){t.filterList.splice(0,t.filterList.length);var i,r=Object(a["a"])(e);try{for(r.s();!(i=r.n()).done;){var n=i.value,l=!0;if(t.filterList.length){var s,o=Object(a["a"])(t.filterList);try{for(o.s();!(s=o.n()).done;){var c=s.value;if(n.field_name===c.field_name&&n.value_range===c.value_range){l=!1;break}}}catch(f){o.e(f)}finally{o.f()}}l&&t.filterList.push(n)}}catch(f){r.e(f)}finally{r.f()}}))},addItem:function(){console.log("addItem"),this.getFilterListByActivityID()}}},I=x,N=(i("60f8"),Object(b["a"])(I,r,n,!1,null,"3bde0ce6",null));e["default"]=N.exports},"3da1":function(t,e,i){"use strict";i("58a6")},"58a6":function(t,e,i){},"60f8":function(t,e,i){"use strict";i("9efd")},"6c93":function(t,e,i){},9129:function(t,e,i){var r=i("23e7");r({target:"Number",stat:!0},{isNaN:function(t){return t!=t}})},"9efd":function(t,e,i){},dbd9:function(t,e,i){"use strict";i("6c93")}}]);