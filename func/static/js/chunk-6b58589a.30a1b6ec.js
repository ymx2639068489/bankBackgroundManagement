(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b58589a"],{"33f1":function(t,e,i){},"359b":function(t,e,i){},"4c08":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{background:"rgb(238,241,246)",height:"calc(100vh - 84px)"}},[i("h2",{staticStyle:{"margin-top":"0"}},[t._v("拖拽式编辑，确定顺序无误后直接点击 确定提交 即可")]),i("div",{staticStyle:{"margin-left":"160px"}},[i("el-button",{attrs:{type:"primary",size:"default"},on:{click:function(e){t.$refs.addBannerItem.dialogVisible=!0}}},[t._v("添加轮播图")]),i("el-button",{attrs:{type:"primary",size:"default"},on:{click:t.srueSubmit}},[t._v("确定提交")])],1),i("div",{staticClass:"components-container board"},[i("Kanban",{key:1,staticClass:"kanban todo",attrs:{list:t.list1,group:t.group,"header-text":"srue banners","style-object":{height:"70vh","overflow-y":"auto","overflow-x":"hidden"}},on:{itemClick:t.itemClick}}),i("Kanban",{key:2,staticClass:"kanban done",attrs:{list:t.list2,group:t.group,"header-text":"buffer images","style-object":{height:"70vh","overflow-y":"auto","overflow-x":"hidden"}},on:{itemClick:t.itemClick}})],1),i("add-banner-item-cpm",{ref:"addBannerItem",on:{addBanner:t.addBanner}}),i("update-banner",{ref:"updateBanner",attrs:{"current-img":t.currentImg},on:{updateBanner:t.updateBanner}})],1)},a=[],s=i("b85c"),l=(i("a434"),i("a4d3"),i("e01a"),i("4e82"),i("d3b7"),i("b775")),o=function(){return new Promise((function(t,e){Object(l["a"])({url:"/api/SlideShow/listAdmin",method:"get"}).then((function(e){t(e.data)})).catch((function(t){e(t)}))}))},r=function(t){return new Promise((function(e,i){var n=new FormData;n.append("file",t.file),n.append("title",t.title),n.append("weight",t.weight),n.append("description",t.description),Object(l["b"])("/api/SlideShow/add",n).then((function(t){0!==t.code&&i(t.msg),e(t.msg)})).catch((function(t){i(t)}))}))},c=function(t){return new Promise((function(e,i){Object(l["a"])({url:"/api/SlideShow/delete",method:"delete",data:JSON.stringify({slide_show_id:t})}).then((function(t){e(t)})).catch((function(t){i(t)}))}))},u=function(t){console.log(t);var e=t.description,i=t.title,n=t.slide_show_id,a=t.weight;return new Promise((function(t,s){Object(l["a"])({url:"/api/SlideShow/update",method:"put",data:JSON.stringify({description:e,title:i,slide_show_id:n,weight:a})}).then((function(e){t(e)})).catch((function(t){s(t)}))}))},d=i("f0b0"),f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.dialogVisible?i("el-dialog",{staticStyle:{width:"1300px"},attrs:{title:"添加轮播图",visible:t.dialogVisible,"before-close":t.handleCloseDialog},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{width:"300px"}},[i("el-form-item",{attrs:{"label-width":"120px",label:"图片标题"}},[i("el-input",{staticStyle:{width:"360px"},attrs:{type:"text"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),i("el-form-item",{attrs:{"label-width":"120px",label:"图片描述"}},[i("el-input",{staticStyle:{width:"360px"},attrs:{type:"textarea",autosize:""},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1),i("el-form-item",{attrs:{"label-width":"120px",label:"权重(顺序)"}},[i("el-input",{staticStyle:{width:"360px"},attrs:{type:"number",min:"1",max:"100"},model:{value:t.weight,callback:function(e){t.weight=e},expression:"weight"}})],1),i("el-form-item",{attrs:{"label-width":"120px",label:"选择图片"}},[i("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline-block","maigin-left":"120px"},attrs:{drag:"",limit:1,"on-exceed":function(){t.$message({message:"最多只能上传一张图片",type:"warning"})},action:"","on-change":t.handleChange,"auto-upload":!1}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),i("em",[t._v("点击上传")])]),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])])],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){return t.handleCloseDialog(e)}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.srueSubmit}},[t._v("确 定")])],1)],1):t._e()},h=[],p={data:function(){return{dialogVisible:!1,description:"",title:"",weight:"",file:null}},watch:{weight:function(t,e){t>100&&(this.weight=e)},dialogVisible:function(t,e){t&&(this.description="",this.title="",this.weight="")}},methods:{handleChange:function(t,e){this.file=t.raw},handleCloseDialog:function(t){var e=this;this.$confirm("确认关闭？").then((function(){"function"===typeof t&&t(),e.dialogVisible=!1})).catch((function(){}))},srueSubmit:function(){var t=this;this.file?this.title?this.$confirm("确认提交？").then((function(){t.$emit("addBanner",{file:t.file,description:t.description,title:t.title,weight:t.weight})})).catch((function(){})):this.$message({message:"请填写图片标题",type:"warning"}):this.$message({message:"请选择图片",type:"warning"})}}},g=p,m=(i("618c"),i("2877")),b=Object(m["a"])(g,f,h,!1,null,"fb9c9f6a",null),v=b.exports,w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.dialogVisible?i("el-dialog",{staticStyle:{width:"1160px"},attrs:{title:"更新图片",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{width:"300px"}},[i("el-form-item",{attrs:{"label-width":"120px",label:"图片标题"}},[i("el-input",{staticStyle:{width:"360px"},attrs:{type:"text"},model:{value:t.Ntitle,callback:function(e){t.Ntitle=e},expression:"Ntitle"}})],1),i("el-form-item",{attrs:{"label-width":"120px",label:"图片描述"}},[i("el-input",{staticStyle:{width:"360px"},attrs:{type:"textarea",autosize:""},model:{value:t.Ndescription,callback:function(e){t.Ndescription=e},expression:"Ndescription"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger"},on:{click:t.deleteBannerItem}},[t._v("删除当前轮播图")]),i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.srueSubmit}},[t._v("确 定")])],1)],1):t._e()},y=[],x={props:{currentImg:{type:Object,default:function(){return{description:"",title:"",id:0,weight:0}}}},data:function(){return{dialogVisible:!1,Ndescription:"",Ntitle:""}},watch:{dialogVisible:function(t,e){t&&(this.Ndescription=this.currentImg.description,this.Ntitle=this.currentImg.title)}},methods:{handleChange:function(t,e){this.file=t.raw},srueSubmit:function(){var t=this;this.Ntitle?this.$confirm("确认提交？").then((function(){t.$emit("updateBanner",{description:t.Ndescription,title:t.Ntitle,slide_show_id:t.currentImg.ID,weight:t.currentImg.weight})})).catch((function(){})):this.$message({message:"请填写图片标题",type:"warning"})},deleteBannerItem:function(){var t=this;this.$confirm("确认删除？").then((function(){c(t.id).then((function(e){console.log(t.$parent.list2);for(var i=0;i<t.$parent.list2.length;i++){var n=t.$parent.list2[i];if(n.ID===t.id){t.$parent.list2.splice(i,1);break}}t.$message({message:"删除成功",type:"success"}),t.dialogVisible=!1,t.$parent.getBanner()}))})).catch((function(){}))}}},_=x,k=(i("df8f"),Object(m["a"])(_,w,y,!1,null,"294fbae2",null)),S=k.exports,$={name:"DragKanbanDemo",components:{Kanban:d["a"],updateBanner:S,addBannerItemCpm:v},data:function(){return{group:"mission",createList:[],list1:[],list2:[],finalList:[],currentImg:{description:"",title:"",ID:0,weight:0}}},created:function(){this.getBanner()},methods:{getBanner:function(){var t=this;o().then((function(e){if(t.list1.splice(0,t.list1.length),e.list){for(var i=0;i<e.list.length;i++){var n,a=!1,l=e.list[i],o=Object(s["a"])(t.list2);try{for(o.s();!(n=o.n()).done;){var r=n.value;if(l.ID===r.ID){a=!0;break}}}catch(c){o.e(c)}finally{o.f()}a||t.list1.push({ID:l.ID,slide_show_id:l.ID,description:l.description,title:l.title,url:l.host+"/"+l.relative_path,weight:l.weight})}t.list1.sort((function(t,e){return t.weight-e.weight}))}}))},addBanner:function(t){var e=this;r(t).then((function(t){e.$message({type:"success",message:t}),e.getBanner(),e.$refs.addBannerItem.dialogVisible=!1}))},itemClick:function(t){this.currentImg=t,this.$refs.updateBanner.dialogVisible=!0},srueSubmit:function(){for(var t=this,e=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),i=0,n=[],a=0;a<this.list1.length;a++)this.list1[a].weight!==a+1&&n.push(a);for(var s=0,l=n;s<l.length;s++){var o=l[s];this.list1[o].weight=o+1,u(this.list1[o]).then((function(t){i++}))}var r=setInterval((function(){i===n.length&&(e.close(),t.$message({type:"success",message:"更新成功"}),t.getBanner(),clearInterval(r))}),1e3)},updateBanner:function(t){var e=this;console.log(t),u(t).then((function(t){e.$message({type:"success",message:t.msg}),setTimeout((function(){e.$refs.updateBanner.dialogVisible=!1}),500),e.getBanner()}))}}},C=$,B=(i("4e31"),Object(m["a"])(C,n,a,!1,null,null,null));e["default"]=B.exports},"4e31":function(t,e,i){"use strict";i("8247")},"4e82":function(t,e,i){"use strict";var n=i("23e7"),a=i("1c0b"),s=i("7b0b"),l=i("d039"),o=i("a640"),r=[],c=r.sort,u=l((function(){r.sort(void 0)})),d=l((function(){r.sort(null)})),f=o("sort"),h=u||!d||!f;n({target:"Array",proto:!0,forced:h},{sort:function(t){return void 0===t?c.call(s(this)):c.call(s(this),a(t))}})},"618c":function(t,e,i){"use strict";i("33f1")},8247:function(t,e,i){},9882:function(t,e,i){},d86f:function(t,e,i){"use strict";i("359b")},df8f:function(t,e,i){"use strict";i("9882")},f0b0:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"board-column-header"},[t._v(" "+t._s(t.headerText)+" ")]),i("div",{staticClass:"board-column",style:t.styleObject},[i("draggable",t._b({staticClass:"board-column-content",attrs:{list:t.list,animation:"600",scroll:t.isScroll,"set-data":t.setData}},"draggable",t.$attrs,!1),t._l(t.list,(function(e){return i("div",{key:e.ID,staticClass:"board-item",on:{click:function(i){return t.itemClick(e)}}},[i("img",{attrs:{src:e.url,alt:"error",title:e.title&&e.description?"标题: "+e.title+"\n描述: "+e.description:""}})])})),0)],1)])},a=[],s=i("1980"),l=i.n(s),o={name:"DragKanbanDemo",components:{draggable:l.a},props:{headerText:{type:String,default:"Header"},styleObject:{type:Object,default:function(){return{}}},isScroll:{type:Boolean,default:!0},list:{type:Array,default:function(){return[]}}},methods:{setData:function(t){t.setData("Text","")},itemClick:function(t){this.$emit("itemClick",t)}}},r=o,c=(i("d86f"),i("2877")),u=Object(c["a"])(r,n,a,!1,null,"c768c150",null);e["a"]=u.exports}}]);